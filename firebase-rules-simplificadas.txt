// Regras Firebase Firestore Simplificadas - SEM ÍNDICES COMPOSTOS
// Copie este conteúdo para o Firebase Console > Firestore Database > Rules

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Regras para a coleção de mensagens do chat
    match /mensagens/{messageId} {
      // Permitir leitura para todos
      allow read: if true;
      
      // Permitir criação de novas mensagens para todos
      allow create: if true;
      
      // Permitir atualização apenas do campo 'resposta' e 'respondido'
      allow update: if request.auth != null &&
        request.writeFields.hasOnly(['resposta', 'respondido']) &&
        resource.data.keys().hasAll(['nome', 'mensagem', 'chat_id', 'hora']);
      
      // Não permitir exclusão de mensagens
      allow delete: if false;
    }
    
    // Regras para outras coleções (se existirem)
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

// IMPORTANTE: 
// 1. Estas regras permitem leitura e escrita básicas sem precisar de índices
// 2. Para produção, você pode adicionar mais validações de segurança
// 3. As consultas no código foram modificadas para evitar usar orderBy
